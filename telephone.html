<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="telephone.css"></link>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="__Capteur.js"></script>
<script>
</script>
<script src="libs/ObjectManager.js"></script>
<script src="libs/views.js"></script>
<style>
	.red {
		color:red;
	}
	.popupWindow{
		background: #fff;
		border: 2px solid #000;
		-webkit-border-radius: 8px;
		border-radius: 8px;
		overflow:hidden;
		padding: 0px;
		width: auto;
		position: fixed;
		font: 12px/16px 'Arial', sans-serif;
	}
	.popupWindowTitlebar {
		background:#ccc;
		height:24px;
		vertical-align:middle;
	}
	.button {
		background:#ccc;
		text-align:center;
		cursor:pointer;
	}
	.button:hover {
		background:#000;
		color:#ccc;
	}
</style>
<body> 
 
</body>
<script>
google.charts.load('current', {'packages':['gauge']});
F.startAutoUpdate();

navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate;

header = function() {
	return  FV.tag("div",{},[
			FV.tag("h2",{width:"auto",textAlign:"center"},"Capteur/Actionneur Simulator "),
	])
};

F.defineProperty("Application", "nom");
F.defineProperty("Application", "telephone");
F.defineProperty("Application", "orientation");



F.defineTrigger(function(){
	if(app.nom != null && !app.telephone){
		app.telephone = F.create("Telephone", {nom: app.nom,orientation:0.0} );
		app.orientation = app.telephone.orientation//F.objetManager.call.getOrCreateTelephone(app.nom,
//					function(retourServeur){return retourServeur;},
//					function(){return F.create("Telephone", {nom: app.nom,orientation:0.0} );}
//					)
	}
});

vibre = function(callback){navigator.vibrate([50,50]);if(app.telephone.vibre) callback(callback);}

F.defineTrigger(function(){
	if(app.telephone != null){
		navigator.vibrate(app.telephone.vibre ? 5000 : 0);
	}
});

defineName = function(){
	return FV.tag("input", {type:"FvText",forsObject:app,forsProperty:"nom"});
};

var gauge = FV.tag("div",{margin:"0 auto",width:"600px"});
google.charts.setOnLoadCallback(function(){
	var options = {
          width: 400, height: 120,
          redFrom: 90, redTo: 100,
          yellowFrom:75, yellowTo: 90,
          minorTicks: 5, animation:{duration:0}
        };

	var chart = new google.visualization.Gauge(gauge.domElt);

	F.defineTrigger(function(){
		if(app.orientation != null){
			var data =  google.visualization.arrayToDataTable([
      						['Label', 'Value'],
        					['Orientation', app.orientation],
        				]);
			chart.draw(data, options);
		}
	});
});

if(window.DeviceOrientationEvent){
	window.addEventListener('deviceorientation', function(){
		if(app.telephone != null){
			app.telephone.orientation = event.beta;
			app.orientation = event.beta;
			F.objetManager.commit();
		}
	})
}


page =  FV.tag("div",{},[
		FV.tag("div",{},header()),
		gauge,
		defineName(),
		FV.tag("button", {
			"background":function(){if(app.telephone == null) return "darkgray"; else return app.telephone.vibre ? "red" : "lightGreen"},
			"onclick":function(){if(app.telephone == null) return; app.telephone.vibre=!app.telephone.vibre; F.objectManager.commit();}
			}, 
			function(){if(app.telephone == null)return "Pas de téléphone enregistré";return  app.telephone.vibre ? "Stop !" : "Vibre !"}
		)
	]
);

document.body.appendChild(page.domElt);
</script>
